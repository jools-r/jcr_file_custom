# Name: jcr_file_custom v0.1 
# Type: Admin/Public plugin
# Adds a custom field to the files panel
# Author: jcr / txpbuilders
# URL: http://txp.builders
# Recommended load order: 5

# .....................................................................
# This is a plugin for Textpattern CMS - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# .....................................................................

YToxNTp7czo0OiJuYW1lIjtzOjE1OiJqY3JfZmlsZV9jdXN0b20iO3M6NzoidmVyc2lvbiI7
czozOiIwLjEiO3M6ODoicmV2aXNpb24iO3M6MDoiIjtzOjY6ImF1dGhvciI7czoxNzoiamNy
IC8gdHhwYnVpbGRlcnMiO3M6MTA6ImF1dGhvcl91cmkiO3M6MTk6Imh0dHA6Ly90eHAuYnVp
bGRlcnMiO3M6MTE6ImRlc2NyaXB0aW9uIjtzOjM4OiJBZGRzIGEgY3VzdG9tIGZpZWxkIHRv
IHRoZSBmaWxlcyBwYW5lbCI7czo1OiJvcmRlciI7czoxOiI1IjtzOjQ6InR5cGUiO3M6MToi
MSI7czo1OiJmbGFncyI7czowOiIiO3M6ODoidGV4dHBhY2siO3M6OTc6IiNAYWRtaW4KI0Bs
YW5ndWFnZSBlbi1nYgpqY3JfZmlsZV9jdXN0b20gPT4gSW1hZ2UgSUQKI0BsYW5ndWFnZSBk
ZS1kZQpqY3JfZmlsZV9jdXN0b20gPT4gQmlsZCBJRAoiO3M6MTA6ImxvYWRfb3JkZXIiO3M6
MToiNSI7czo0OiJoZWxwIjtzOjMwMjg6IjxoMT5qY3JfZmlsZV9jdXN0b208L2gxPgoKPHA+
QWRkcyBhIHNpbmdsZSBleHRyYSBjdXN0b20gZmllbGQgb2YgdXAgdG8gMjU1IGNoYXJhY3Rl
cnMgdG8gdGhlIDxhIGhyZWY9Imh0dHA6Ly9kb2NzLnRleHRwYXR0ZXJuLmlvL2FkbWluaXN0
cmF0aW9uL2ZpbGVzLXBhbmVsIj5BZG1pbiDigLogRmlsZXM8L2E+IHBhbmVsIGFuZCBwcm92
aWRlcyBhIGNvcnJlc3BvbmRpbmcgdGFnIHRvIG91dHB1dCB0aGUgY3VzdG9tIGZpZWxkLjwv
cD4KCgo8aDI+VXNlIGNhc2VzPC9oMj4KCjxwPlVzZSB3aGVuZXZlciBleHRyYSBpbmZvcm1h
dGlvbiBuZWVkcyB0byBiZSBzdG9yZWQgd2l0aCBhIGZpbGUuIEZvciBleGFtcGxlOjwvcD4K
Cjx1bD4KCTxsaT5TdG9yZSBhIHR4cCBpbWFnZSBJRCBudW1iZXIgYW5kIHVzZSBpdCB0byBh
c3NvY2lhdGUgYSBjb3ZlciBpbWFnZSB3aXRoIHRoZSBmaWxlLjwvbGk+Cgk8bGk+U3RvcmUg
YXNzb2NpYXRlZCBkZXRhaWxzLCBmb3IgZXhhbXBsZSB0aGUgYXV0aG9yKHMpIG9mIGEgZG9j
dW1lbnQgb3IgZHVyYXRpb24gb2YgYSBtdXNpYyB0cmFjay48L2xpPgoJPGxpPuKApjwvbGk+
CjwvdWw+CgoKPGgyIGlkPSJpbnN0YWxsYXRpb24iPkluc3RhbGxhdGlvbjwvaDI+Cgo8cD5Q
YXN0ZSB0aGUgY29kZSBpbnRvIHRoZSAgPGVtPkFkbWluIOKAuiBQbHVnaW5zPC9lbT4gcGFu
ZWwsIGluc3RhbGwgYW5kIGVuYWJsZSB0aGUgcGx1Z2luLjwvcD4KCgo8aDIgaWQ9InRhZ3Mi
PlRhZ3M8L2gyPgoKPHByZT48Y29kZT4mbHQ7dHhwOmpjcl9maWxlX2N1c3RvbSAvJmd0Ozwv
Y29kZT48L3ByZT4KCjxwPk91dHB1dHMgdGhlIGNvbnRlbnQgb2YgdGhlIGZpbGUgY3VzdG9t
IGZpZWxkLjwvcD4KCjxoMz5UYWcgYXR0cmlidXRlczwvaDM+Cgo8cD48c3Ryb25nPmVzY2Fw
ZTwvc3Ryb25nPjxiciAvPgpFc2NhcGUgPHNwYW4gY2xhc3M9ImNhcHMiPkhUTUw8L3NwYW4+
IGVudGl0aWVzIHN1Y2ggYXMgPGNvZGU+Jmx0OzwvY29kZT4sIDxjb2RlPiZndDs8L2NvZGU+
IGFuZCA8Y29kZT4mYW1wOzwvY29kZT4gcHJpb3IgdG8gZWNob2luZyB0aGUgZmllbGQgY29u
dGVudHMuPGJyIC8+CkV4YW1wbGU6IFVzZSA8Y29kZT5lc2NhcGU9JnF1b3Q7JnF1b3Q7PC9j
b2RlPiB0byBzdXBwcmVzcyBjb252ZXJzaW9uLiBEZWZhdWx0OiA8Y29kZT5odG1sPC9jb2Rl
Pi48L3A+CgoKPGgyIGlkPSJleGFtcGxlcyI+RXhhbXBsZTwvaDI+Cgo8cD5Qcm9kdWNlIGEg
bGlzdCBvZiBkb3dubG9hZGFibGUgZG9jdW1lbnRzIChhc3NpZ25lZCB0byB0aGUgZmlsZSBj
YXRlZ29yeSAmIzgyMjA7aXNzdWVzJiM4MjIxOykgd2l0aCB0aGVpciBwdWJsaWNhdGlvbiBj
b3ZlcnM6PC9wPgoKPHByZT48Y29kZT4mbHQ7dHhwOmZpbGVfZG93bmxvYWRfbGlzdCB3cmFw
dGFnPSZxdW90O3VsJnF1b3Q7IGJyZWFrPSZxdW90O2xpJnF1b3Q7IGNhdGVnb3J5PSZxdW90
O2lzc3VlcyZxdW90OyZndDsKICAmbHQ7YSBocmVmPSZxdW90OyZsdDt0eHA6ZmlsZV9kb3du
bG9hZF9saW5rIC8mZ3Q7JnF1b3Q7IHRpdGxlPSZxdW90OyZsdDt0eHA6ZmlsZV9kb3dubG9h
ZF9uYW1lIC8mZ3Q7JnF1b3Q7Jmd0OwogICAgJmx0O3R4cDppbWFnZSBpZD0mIzM5OyZsdDt0
eHA6amNyX2ZpbGVfY3VzdG9tIC8mZ3Q7JiMzOTsgLyZndDsKICAmbHQ7L2EmZ3Q7CiZsdDsv
dHhwOmZpbGVfZG93bmxvYWRfbGlzdCZndDs8L2NvZGU+PC9wcmU+Cgo8cD53aGVuIHRoZSBm
aWxlIGN1c3RvbSBmaWVsZCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBJbWFnZSBJRCMgb2YgdGhl
IGRvY3VtZW50IGNvdmVyIGltYWdlLjwvcD4KCgo8aDI+Q2hhbmdpbmcgdGhlIGxhYmVsIG9m
IHRoZSBjdXN0b20gZmllbGQ8L2gyPgoKPHA+VGhlIG5hbWUgb2YgY3VzdG9tIGZpZWxkIGNh
biBiZSBjaGFuZ2VkIGJ5IHNwZWNpZnlpbmcgYSBuZXcgbGFiZWwgdXNpbmcgdGhlIDxlbT5J
bnN0YWxsIGZyb20gVGV4dHBhY2s8L2VtPiBmaWVsZCBpbiB0aGUgPGEgaHJlZj0iaHR0cDov
L2RvY3MudGV4dHBhdHRlcm4uaW8vYWRtaW5pc3RyYXRpb24vbGFuZ3VhZ2VzLXBhbmVsLmh0
bWwiPkFkbWluIOKAuiBMYW5ndWFnZXM8L2E+IHBhbmVsLiBFbnRlciB5b3VyIG93biBpbmZv
cm1hdGlvbiBpbiB0aGUgZm9sbG93aW5nIHBhdHRlcm4gYW5kIGNsaWNrIDxzdHJvbmc+VXBs
b2FkPC9zdHJvbmc+OjwvcD4KCjxwcmU+PGNvZGU+I0BhZG1pbgojQGxhbmd1YWdlIGVuLWdi
Cmpjcl9maWxlX2N1c3RvbSA9Jmd0OyBZb3VyIGxhYmVsPC9jb2RlPjwvcHJlPgoKPHA+cmVw
bGFjaW5nIDxjb2RlPmVuLWdiPC9jb2RlPiB3aXRoIHlvdXIgb3duIGxhbmd1YWdlIGFuZCA8
Y29kZT5JbWFnZSBJRDwvY29kZT4gd2l0aCB5b3VyIG93biBkZXNpcmVkIGxhYmVsLjwvcD4K
Cgo8aDIgaWQ9ImRlaW5zdGFsbGF0aW9uIj5EZS1pbnN0YWxsYXRpb248L2gyPgoKPHA+VGhl
IHBsdWdpbiBjbGVhbnMgdXAgYWZ0ZXIgaXRzZWxmOiBkZWluc3RhbGxpbmcgdGhlIHBsdWdp
biByZW1vdmVzIHRoZSBleHRyYSBjb2x1bW4gZnJvbSB0aGUgZGF0YWJhc2UuIFRvIHN0b3Ag
dXNpbmcgdGhlIHBsdWdpbiBidXQga2VlcCB0aGUgZGF0YWJhc2UgdGFibGVzLCBqdXN0IGRp
c2FibGUgKGRlYWN0aXZhdGUpIHRoZSBwbHVnaW4gYnV0IGRvbiYjODIxNzt0IGRlbGV0ZSBp
dC48L3A+CgoKPGgyIGlkPSJjaGFuZ2Vsb2ciPkNoYW5nZWxvZzwvaDI+Cgo8aDM+VmVyc2lv
biAwLjEg4oCTIDIwMTYvMDMvMDQ8L2gzPgoKPHVsPgoJPGxpPkZpcnN0IHJlbGVhc2U8L2xp
Pgo8L3VsPgoKCjxoMiBpZD0iY3JlZGl0cyI+Q3JlZGl0czwvaDI+Cgo8cD5Sb2JlcnQgV2V0
emxtYXly4oCZcyA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vcndldHpsbWF5ci93ZXRf
cHJvZmlsZSI+d2V0X3Byb2ZpbGU8L2E+IHBsdWdpbiBmb3IgdGhlIHN0YXJ0aW5nIHBvaW50
LCBhbmQgZnVydGhlciBleGFtcGxlcyBieSA8YSBocmVmPSJodHRwOi8vd3d3LnN0ZWZkYXdz
b24uY29tIj5TdGVmIERhd3NvbjwvYT4gYW5kIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNv
bS9nb2NvbSI+SnVra2EgU3ZhaG48L2E+LjwvcD4iO3M6MzoiY3NzIjtzOjA6IiI7czo0OiJj
b2RlIjtzOjI3MTE6ImNsYXNzIGpjcl9maWxlX2N1c3RvbQp7CgkvKioKCSAqIEluaXRpYWxp
c2UuCgkgKi8KCSBmdW5jdGlvbiBfX2NvbnN0cnVjdCgpCgl7CgkJLy8gSG9vayBpbnRvIHRo
ZSBzeXN0ZW0ncyBjYWxsYmFja3MuCgkJcmVnaXN0ZXJfY2FsbGJhY2soYXJyYXkoX19DTEFT
U19fLCAnbGlmZWN5Y2xlJyksICdwbHVnaW5fbGlmZWN5Y2xlLmpjcl9maWxlX2N1c3RvbScp
OwoJCXJlZ2lzdGVyX2NhbGxiYWNrKGFycmF5KF9fQ0xBU1NfXywgJ3VpJyksICdmaWxlX3Vp
JywgJ2V4dGVuZF9kZXRhaWxfZm9ybScpOwoJCXJlZ2lzdGVyX2NhbGxiYWNrKGFycmF5KF9f
Q0xBU1NfXywgJ3NhdmUnKSwgJ2ZpbGUnLCAnZmlsZV9zYXZlJyk7Cgl9CgoJLyoqCiAgICog
QWRkIGFuZCByZW1vdmUgY3VzdG9tIGZpZWxkIGZyb20gdHhwX2ZpbGUgdGFibGUuCiAgICoK
ICAgKiBAcGFyYW0gJGV2ZW50IHN0cmluZwogICAqIEBwYXJhbSAkc3RlcCBzdHJpbmcgIFRo
ZSBsaWZlY3ljbGUgcGhhc2Ugb2YgdGhpcyBwbHVnaW4KICAgKi8KICBwdWJsaWMgc3RhdGlj
IGZ1bmN0aW9uIGxpZmVjeWNsZSgkZXZlbnQsICRzdGVwKQogIHsKICAgICAgc3dpdGNoICgk
c3RlcCkgewogICAgICAgICAgY2FzZSAnZW5hYmxlZCc6CiAgICAgICAgICAgICAgYnJlYWs7
CiAgICAgICAgICBjYXNlICdkaXNhYmxlZCc6CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAg
ICAgICBjYXNlICdpbnN0YWxsZWQnOgogICAgICAgICAgICAgIHNhZmVfYWx0ZXIoCiAgICAg
ICAgICAgICAgICAndHhwX2ZpbGUnLAogICAgICAgICAgICAgICAgJ0FERCBDT0xVTU4gamNy
X2ZpbGVfY3VzdG9tIFZBUkNIQVIoMjU1KSBOVUxMIEFGVEVSIGF1dGhvcicKICAgICAgICAg
ICAgICApOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnZGVsZXRlZCc6
CiAgICAgICAgICAgICAgc2FmZV9hbHRlcigKICAgICAgICAgICAgICAgICd0eHBfZmlsZScs
CiAgICAgICAgICAgICAgICAnRFJPUCBDT0xVTU4gamNyX2ZpbGVfY3VzdG9tJwogICAgICAg
ICAgICAgICk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgcmV0dXJuOwog
IH0KCgkvKioKCSAqIFBhaW50IGFkZGl0aW9uYWwgZmllbGRzIGZvciBmaWxlIGN1c3RvbSBm
aWVsZAoJICoKCSAqIEBwYXJhbSAkZXZlbnQgc3RyaW5nCgkgKiBAcGFyYW0gJHN0ZXAgc3Ry
aW5nCgkgKiBAcGFyYW0gJGR1bW15IHN0cmluZwoJICogQHBhcmFtICRycyBhcnJheSBUaGUg
Y3VycmVudCBmaWxlJ3MgZGF0YQoJICogQHJldHVybiBzdHJpbmcKCSAqLwoJcHVibGljIHN0
YXRpYyBmdW5jdGlvbiB1aSgkZXZlbnQsICRzdGVwLCAkZHVtbXksICRycykKCXsKCQlleHRy
YWN0KGxBdHRzKGFycmF5KAoJCQknamNyX2ZpbGVfY3VzdG9tJyA9PiAnJwoJCSksICRycywg
MCkpOwoKCQlyZXR1cm4KCQkJaW5wdXRMYWJlbCgnamNyX2ZpbGVfY3VzdG9tJywgZklucHV0
KCd0ZXh0JywgJ2pjcl9maWxlX2N1c3RvbScsICRqY3JfZmlsZV9jdXN0b20sICcnLCAnJywg
JycsIElOUFVUX1JFR1VMQVIsICcnLCAnamNyX2ZpbGVfY3VzdG9tJyksICdqY3JfZmlsZV9j
dXN0b20nKS5uOwoJfQoKCS8qKgoJICogU2F2ZSBhZGRpdGlvbmFsIGZpbGUgY3VzdG9tIGZp
ZWxkcwoJICoKCSAqIEBwYXJhbSAkZXZlbnQgc3RyaW5nCgkgKiBAcGFyYW0gJHN0ZXAgc3Ry
aW5nCgkgKi8KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gc2F2ZSgkZXZlbnQsICRzdGVwKQoJ
ewoJCWV4dHJhY3QoZG9TbGFzaChwc2EoYXJyYXkoJ2pjcl9maWxlX2N1c3RvbScsICdpZCcp
KSkpOwoJCSRpZCA9IGFzc2VydF9pbnQoJGlkKTsKCQlzYWZlX3VwZGF0ZSgndHhwX2ZpbGUn
LAoJCSAgImpjcl9maWxlX2N1c3RvbSA9ICckamNyX2ZpbGVfY3VzdG9tJyIsCgkJCSJpZCA9
ICRpZCIKCQkpOwoJfQp9CgppZiAodHhwaW50ZXJmYWNlID09PSAnYWRtaW4nKSB7CgogICAg
bmV3IGpjcl9maWxlX2N1c3RvbTsKCn0gZWxzZWlmICh0eHBpbnRlcmZhY2UgPT09ICdwdWJs
aWMnKSB7CgogICAgaWYgKGNsYXNzX2V4aXN0cygnXFRleHRwYXR0ZXJuXFRhZ1xSZWdpc3Ry
eScpKSB7CiAgICAgICAgVHhwOjpnZXQoJ1xUZXh0cGF0dGVyblxUYWdcUmVnaXN0cnknKQog
ICAgICAgICAgICAtPnJlZ2lzdGVyKCdqY3JfZmlsZV9jdXN0b20nKTsKICAgIH0KCn0KCiAg
LyoqCiAgICogUHVibGljIHRhZzogc2hvdyBjdXN0b20gZmlsZSBmaWVsZAogICAqIEBwYXJh
bSAgc3RyaW5nICRhdHRzW2VzY2FwZV0gQ29udmVydCBzcGVjaWFsIGNoYXJhY3RlcnMgdG8g
SFRNTCBlbnRpdGllcy4KICAgKiBAcmV0dXJuIHN0cmluZyBjdXN0b20gZmllbGQgb3V0cHV0
CiAgICogPGNvZGU+CiAgICogICAgICAgIDx0eHA6amNyX2ZpbGVfY3VzdG9tIGVzY2FwZT0i
aHRtbCIgLz4KICAgKiA8L2NvZGU+CiAgICovCgogICAgZnVuY3Rpb24gamNyX2ZpbGVfY3Vz
dG9tKCRhdHRzKQogICAgewogICAgICAgIGdsb2JhbCAkdGhpc2ZpbGU7CgogICAgICAgIGFz
c2VydF9maWxlKCk7CgogICAgICAgIGV4dHJhY3QobEF0dHMoYXJyYXkoCiAgICAgICAgICAg
ICdlc2NhcGUnID0+ICdodG1sJywKICAgICAgICApLCAkYXR0cykpOwoKICAgICAgICByZXR1
cm4gKCRlc2NhcGUgPT0gJ2h0bWwnKQogICAgICAgICAgICA/IHR4cHNwZWNpYWxjaGFycygk
dGhpc2ZpbGVbJ2pjcl9maWxlX2N1c3RvbSddKQogICAgICAgICAgICA6ICR0aGlzZmlsZVsn
amNyX2ZpbGVfY3VzdG9tJ107CiAgICB9IjtzOjM6Im1kNSI7czozMjoiMTFjOWI3MGRhYmYy
ZTE0ODMwZmYyMDdiOTZkOThiNmIiO30=
