# Name: jcr_file_custom v0.1 
# Type: Admin/Public plugin
# Adds a custom field to the files panel
# Author: jcr / txpbuilders
# URL: http://txp.builders
# Recommended load order: 5

# .....................................................................
# This is a plugin for Textpattern CMS - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# .....................................................................

YToxNTp7czo0OiJuYW1lIjtzOjE1OiJqY3JfZmlsZV9jdXN0b20iO3M6NzoidmVyc2lvbiI7
czozOiIwLjEiO3M6ODoicmV2aXNpb24iO3M6MDoiIjtzOjY6ImF1dGhvciI7czoxNzoiamNy
IC8gdHhwYnVpbGRlcnMiO3M6MTA6ImF1dGhvcl91cmkiO3M6MTk6Imh0dHA6Ly90eHAuYnVp
bGRlcnMiO3M6MTE6ImRlc2NyaXB0aW9uIjtzOjM4OiJBZGRzIGEgY3VzdG9tIGZpZWxkIHRv
IHRoZSBmaWxlcyBwYW5lbCI7czo1OiJvcmRlciI7czoxOiI1IjtzOjQ6InR5cGUiO3M6MToi
MSI7czo1OiJmbGFncyI7czowOiIiO3M6ODoidGV4dHBhY2siO3M6OTc6IiNAYWRtaW4KI0Bs
YW5ndWFnZSBlbi1nYgpqY3JfZmlsZV9jdXN0b20gPT4gSW1hZ2UgSUQKI0BsYW5ndWFnZSBk
ZS1kZQpqY3JfZmlsZV9jdXN0b20gPT4gQmlsZCBJRAoiO3M6MTA6ImxvYWRfb3JkZXIiO3M6
MToiNSI7czo0OiJoZWxwIjtzOjMwMjc6IjxoMT5qY3JfZmlsZV9jdXN0b208L2gxPgoKPHA+
QWRkcyBhIHNpbmdsZSBleHRyYSBjdXN0b20gZmllbGQgb2YgdXAgdG8gMjU1IGNoYXJhY3Rl
cnMgdG8gdGhlIDxhIGhyZWY9Imh0dHA6Ly9kb2NzLnRleHRwYXR0ZXJuLmlvL2FkbWluaXN0
cmF0aW9uL2ZpbGVzLXBhbmVsIj5Db250ZW50IOKAuiBGaWxlczwvYT4gcGFuZWwgYW5kIHBy
b3ZpZGVzIGEgY29ycmVzcG9uZGluZyB0YWcgdG8gb3V0cHV0IHRoZSBjdXN0b20gZmllbGQu
PC9wPgoKCjxoMj5Vc2UgY2FzZXM8L2gyPgoKPHA+VXNlIHdoZW5ldmVyIGV4dHJhIGluZm9y
bWF0aW9uIG5lZWRzIHRvIGJlIHN0b3JlZCB3aXRoIGEgZmlsZS4gRm9yIGV4YW1wbGU6PC9w
PgoKPHVsPgoJPGxpPlN0b3JlIGEgdHhwIGltYWdlIElEIG51bWJlciBhbmQgdXNlIGl0IHRv
IGFzc29jaWF0ZSBhIGNvdmVyIGltYWdlIHdpdGggdGhlIGZpbGUuPC9saT4KCTxsaT5TdG9y
ZSBhc3NvY2lhdGVkIGRldGFpbHMsIGZvciBleGFtcGxlIHRoZSBhdXRob3Iocykgb2YgYSBk
b2N1bWVudCBvciBkdXJhdGlvbiBvZiBhIG11c2ljIHRyYWNrLjwvbGk+Cgk8bGk+4oCmPC9s
aT4KPC91bD4KCgo8aDIgaWQ9Imluc3RhbGxhdGlvbiI+SW5zdGFsbGF0aW9uPC9oMj4KCjxw
PlBhc3RlIHRoZSBjb2RlIGludG8gdGhlICA8ZW0+QWRtaW4g4oC6IFBsdWdpbnM8L2VtPiBw
YW5lbCwgaW5zdGFsbCBhbmQgZW5hYmxlIHRoZSBwbHVnaW4uPC9wPgoKCjxoMiBpZD0idGFn
cyI+VGFnczwvaDI+Cgo8cHJlPjxjb2RlPiZsdDt0eHA6amNyX2ZpbGVfY3VzdG9tIC8mZ3Q7
PC9jb2RlPjwvcHJlPgoKPHA+T3V0cHV0cyB0aGUgY29udGVudCBvZiB0aGUgZmlsZSBjdXN0
b20gZmllbGQuPC9wPgoKPGgzPlRhZyBhdHRyaWJ1dGVzPC9oMz4KCjxwPjxzdHJvbmc+ZXNj
YXBlPC9zdHJvbmc+PGJyIC8+CkVzY2FwZSA8c3BhbiBjbGFzcz0iY2FwcyI+SFRNTDwvc3Bh
bj4gZW50aXRpZXMgc3VjaCBhcyA8Y29kZT4mbHQ7PC9jb2RlPiwgPGNvZGU+Jmd0OzwvY29k
ZT4gYW5kIDxjb2RlPiZhbXA7PC9jb2RlPiBwcmlvciB0byBlY2hvaW5nIHRoZSBmaWVsZCBj
b250ZW50cy48YnIgLz4KRXhhbXBsZTogVXNlIDxjb2RlPmVzY2FwZT0mcXVvdDsmcXVvdDs8
L2NvZGU+IHRvIHN1cHByZXNzIGNvbnZlcnNpb24uIERlZmF1bHQ6IDxjb2RlPmh0bWw8L2Nv
ZGU+LjwvcD4KCgo8aDIgaWQ9ImV4YW1wbGVzIj5FeGFtcGxlPC9oMj4KCjxwPlByb2R1Y2Ug
YSBsaXN0IG9mIGRvd25sb2FkYWJsZSBkb2N1bWVudHMgKGFzc2lnbmVkIHRvIHRoZSBmaWxl
IGNhdGVnb3J5ICYjODIyMDtpc3N1ZXMmIzgyMjE7KSB3aXRoIHRoZWlyIHB1YmxpY2F0aW9u
IGNvdmVyczo8L3A+Cgo8cHJlPjxjb2RlPiZsdDt0eHA6ZmlsZV9kb3dubG9hZF9saXN0IHdy
YXB0YWc9JnF1b3Q7dWwmcXVvdDsgYnJlYWs9JnF1b3Q7bGkmcXVvdDsgY2F0ZWdvcnk9JnF1
b3Q7aXNzdWVzJnF1b3Q7Jmd0OwogICZsdDthIGhyZWY9JnF1b3Q7Jmx0O3R4cDpmaWxlX2Rv
d25sb2FkX2xpbmsgLyZndDsmcXVvdDsgdGl0bGU9JnF1b3Q7Jmx0O3R4cDpmaWxlX2Rvd25s
b2FkX25hbWUgLyZndDsmcXVvdDsmZ3Q7CiAgICAmbHQ7dHhwOmltYWdlIGlkPSYjMzk7Jmx0
O3R4cDpqY3JfZmlsZV9jdXN0b20gLyZndDsmIzM5OyAvJmd0OwogICZsdDsvYSZndDsKJmx0
Oy90eHA6ZmlsZV9kb3dubG9hZF9saXN0Jmd0OzwvY29kZT48L3ByZT4KCjxwPndoZW4gdGhl
IGZpbGUgY3VzdG9tIGZpZWxkIGlzIHVzZWQgdG8gc3RvcmUgdGhlIEltYWdlIElEIyBvZiB0
aGUgZG9jdW1lbnQgY292ZXIgaW1hZ2UuPC9wPgoKCjxoMj5DaGFuZ2luZyB0aGUgbGFiZWwg
b2YgdGhlIGN1c3RvbSBmaWVsZDwvaDI+Cgo8cD5UaGUgbmFtZSBvZiBjdXN0b20gZmllbGQg
Y2FuIGJlIGNoYW5nZWQgYnkgc3BlY2lmeWluZyBhIG5ldyBsYWJlbCB1c2luZyB0aGUgPGVt
Pkluc3RhbGwgZnJvbSBUZXh0cGFjazwvZW0+IGZpZWxkIGluIHRoZSA8YSBocmVmPSJodHRw
Oi8vZG9jcy50ZXh0cGF0dGVybi5pby9hZG1pbmlzdHJhdGlvbi9sYW5ndWFnZXMtcGFuZWwi
PkFkbWluIOKAuiBMYW5ndWFnZXM8L2E+IHBhbmVsLiBFbnRlciB5b3VyIG93biBpbmZvcm1h
dGlvbiBpbiB0aGUgZm9sbG93aW5nIHBhdHRlcm4gYW5kIGNsaWNrIDxzdHJvbmc+VXBsb2Fk
PC9zdHJvbmc+OjwvcD4KCjxwcmU+PGNvZGU+I0BhZG1pbgojQGxhbmd1YWdlIGVuLWdiCmpj
cl9maWxlX2N1c3RvbSA9Jmd0OyBZb3VyIGxhYmVsPC9jb2RlPjwvcHJlPgoKPHA+cmVwbGFj
aW5nIDxjb2RlPmVuLWdiPC9jb2RlPiB3aXRoIHlvdXIgb3duIGxhbmd1YWdlIGFuZCA8Y29k
ZT5Zb3VyIGxhYmVsPC9jb2RlPiB3aXRoIHlvdXIgb3duIGRlc2lyZWQgbGFiZWwuPC9wPgoK
CjxoMiBpZD0iZGVpbnN0YWxsYXRpb24iPkRlLWluc3RhbGxhdGlvbjwvaDI+Cgo8cD5UaGUg
cGx1Z2luIGNsZWFucyB1cCBhZnRlciBpdHNlbGY6IGRlaW5zdGFsbGluZyB0aGUgcGx1Z2lu
IHJlbW92ZXMgdGhlIGV4dHJhIGNvbHVtbiBmcm9tIHRoZSBkYXRhYmFzZS4gVG8gc3RvcCB1
c2luZyB0aGUgcGx1Z2luIGJ1dCBrZWVwIHRoZSBkYXRhYmFzZSB0YWJsZXMsIGp1c3QgZGlz
YWJsZSAoZGVhY3RpdmF0ZSkgdGhlIHBsdWdpbiBidXQgZG9uJiM4MjE3O3QgZGVsZXRlIGl0
LjwvcD4KCgo8aDIgaWQ9ImNoYW5nZWxvZyI+Q2hhbmdlbG9nPC9oMj4KCjxoMz5WZXJzaW9u
IDAuMSDigJMgMjAxNi8wMy8wNDwvaDM+Cgo8dWw+Cgk8bGk+Rmlyc3QgcmVsZWFzZTwvbGk+
CjwvdWw+CgoKPGgyIGlkPSJjcmVkaXRzIj5DcmVkaXRzPC9oMj4KCjxwPlJvYmVydCBXZXR6
bG1heXLigJlzIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9yd2V0emxtYXlyL3dldF9w
cm9maWxlIj53ZXRfcHJvZmlsZTwvYT4gcGx1Z2luIGZvciB0aGUgc3RhcnRpbmcgcG9pbnQs
IGFuZCBmdXJ0aGVyIGV4YW1wbGVzIGJ5IDxhIGhyZWY9Imh0dHA6Ly93d3cuc3RlZmRhd3Nv
bi5jb20iPlN0ZWYgRGF3c29uPC9hPiBhbmQgPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29t
L2dvY29tIj5KdWtrYSBTdmFobjwvYT4uPC9wPiI7czozOiJjc3MiO3M6MDoiIjtzOjQ6ImNv
ZGUiO3M6MjcxMzoiY2xhc3MgamNyX2ZpbGVfY3VzdG9tCnsKCS8qKgoJICogSW5pdGlhbGlz
ZS4KCSAqLwoJIGZ1bmN0aW9uIF9fY29uc3RydWN0KCkKCXsKCQkvLyBIb29rIGludG8gdGhl
IHN5c3RlbSdzIGNhbGxiYWNrcy4KCQlyZWdpc3Rlcl9jYWxsYmFjayhhcnJheShfX0NMQVNT
X18sICdsaWZlY3ljbGUnKSwgJ3BsdWdpbl9saWZlY3ljbGUuamNyX2ZpbGVfY3VzdG9tJyk7
CgkJcmVnaXN0ZXJfY2FsbGJhY2soYXJyYXkoX19DTEFTU19fLCAndWknKSwgJ2ZpbGVfdWkn
LCAnZXh0ZW5kX2RldGFpbF9mb3JtJyk7CgkJcmVnaXN0ZXJfY2FsbGJhY2soYXJyYXkoX19D
TEFTU19fLCAnc2F2ZScpLCAnZmlsZScsICdmaWxlX3NhdmUnKTsKCX0KCgkvKioKICAgKiBB
ZGQgYW5kIHJlbW92ZSBjdXN0b20gZmllbGQgZnJvbSB0eHBfZmlsZSB0YWJsZS4KICAgKgog
ICAqIEBwYXJhbSAkZXZlbnQgc3RyaW5nCiAgICogQHBhcmFtICRzdGVwIHN0cmluZyAgVGhl
IGxpZmVjeWNsZSBwaGFzZSBvZiB0aGlzIHBsdWdpbgogICAqLwogIHB1YmxpYyBzdGF0aWMg
ZnVuY3Rpb24gbGlmZWN5Y2xlKCRldmVudCwgJHN0ZXApCiAgewogICAgICBzd2l0Y2ggKCRz
dGVwKSB7CiAgICAgICAgICBjYXNlICdlbmFibGVkJzoKICAgICAgICAgICAgICBicmVhazsK
ICAgICAgICAgIGNhc2UgJ2Rpc2FibGVkJzoKICAgICAgICAgICAgICBicmVhazsKICAgICAg
ICAgIGNhc2UgJ2luc3RhbGxlZCc6CiAgICAgICAgICAgICAgc2FmZV9hbHRlcigKICAgICAg
ICAgICAgICAgICd0eHBfZmlsZScsCiAgICAgICAgICAgICAgICAnQUREIENPTFVNTiBqY3Jf
ZmlsZV9jdXN0b20gVkFSQ0hBUigyNTUpIE5VTEwgQUZURVIgYXV0aG9yJwogICAgICAgICAg
ICAgICk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdkZWxldGVkJzoK
ICAgICAgICAgICAgICBzYWZlX2FsdGVyKAogICAgICAgICAgICAgICAgJ3R4cF9maWxlJywK
ICAgICAgICAgICAgICAgICdEUk9QIENPTFVNTiBqY3JfZmlsZV9jdXN0b20nCiAgICAgICAg
ICAgICAgKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICByZXR1cm47CiAg
fQoKCS8qKgoJICogUGFpbnQgYWRkaXRpb25hbCBmaWVsZHMgZm9yIGZpbGUgY3VzdG9tIGZp
ZWxkCgkgKgoJICogQHBhcmFtICRldmVudCBzdHJpbmcKCSAqIEBwYXJhbSAkc3RlcCBzdHJp
bmcKCSAqIEBwYXJhbSAkZHVtbXkgc3RyaW5nCgkgKiBAcGFyYW0gJHJzIGFycmF5IFRoZSBj
dXJyZW50IGZpbGUncyBkYXRhCgkgKiBAcmV0dXJuIHN0cmluZwoJICovCglwdWJsaWMgc3Rh
dGljIGZ1bmN0aW9uIHVpKCRldmVudCwgJHN0ZXAsICRkdW1teSwgJHJzKQoJewoJCWV4dHJh
Y3QobEF0dHMoYXJyYXkoCgkJCSdqY3JfZmlsZV9jdXN0b20nID0+ICcnCgkJKSwgJHJzLCAw
KSk7CgoJCXJldHVybgoJCQlpbnB1dExhYmVsKCdqY3JfZmlsZV9jdXN0b20nLCBmSW5wdXQo
J3RleHQnLCAnamNyX2ZpbGVfY3VzdG9tJywgJGpjcl9maWxlX2N1c3RvbSwgJycsICcnLCAn
JywgSU5QVVRfUkVHVUxBUiwgJycsICdqY3JfZmlsZV9jdXN0b20nKSwgJ2pjcl9maWxlX2N1
c3RvbScpLm47Cgl9CgoJLyoqCgkgKiBTYXZlIGFkZGl0aW9uYWwgZmlsZSBjdXN0b20gZmll
bGRzCgkgKgoJICogQHBhcmFtICRldmVudCBzdHJpbmcKCSAqIEBwYXJhbSAkc3RlcCBzdHJp
bmcKCSAqLwoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBzYXZlKCRldmVudCwgJHN0ZXApCgl7
CgkJZXh0cmFjdChkb1NsYXNoKHBzYShhcnJheSgnamNyX2ZpbGVfY3VzdG9tJywgJ2lkJykp
KSk7CgkJJGlkID0gYXNzZXJ0X2ludCgkaWQpOwoJCXNhZmVfdXBkYXRlKCd0eHBfZmlsZScs
CgkJICAiamNyX2ZpbGVfY3VzdG9tID0gJyRqY3JfZmlsZV9jdXN0b20nIiwKCQkJImlkID0g
JGlkIgoJCSk7Cgl9Cn0KCmlmICh0eHBpbnRlcmZhY2UgPT09ICdhZG1pbicpIHsKCiAgICBu
ZXcgamNyX2ZpbGVfY3VzdG9tOwoKfSBlbHNlaWYgKHR4cGludGVyZmFjZSA9PT0gJ3B1Ymxp
YycpIHsKCiAgICBpZiAoY2xhc3NfZXhpc3RzKCdcVGV4dHBhdHRlcm5cVGFnXFJlZ2lzdHJ5
JykpIHsKICAgICAgICBUeHA6OmdldCgnXFRleHRwYXR0ZXJuXFRhZ1xSZWdpc3RyeScpCiAg
ICAgICAgICAgIC0+cmVnaXN0ZXIoJ2pjcl9maWxlX2N1c3RvbScpOwogICAgfQoKfQoKICAv
KioKICAgKiBQdWJsaWMgdGFnOiBPdXRwdXQgY3VzdG9tIGZpbGUgZmllbGQKICAgKiBAcGFy
YW0gIHN0cmluZyAkYXR0c1tlc2NhcGVdIENvbnZlcnQgc3BlY2lhbCBjaGFyYWN0ZXJzIHRv
IEhUTUwgZW50aXRpZXMuCiAgICogQHJldHVybiBzdHJpbmcgY3VzdG9tIGZpZWxkIG91dHB1
dAogICAqIDxjb2RlPgogICAqICAgICAgICA8dHhwOmpjcl9maWxlX2N1c3RvbSBlc2NhcGU9
Imh0bWwiIC8+CiAgICogPC9jb2RlPgogICAqLwoKICAgIGZ1bmN0aW9uIGpjcl9maWxlX2N1
c3RvbSgkYXR0cykKICAgIHsKICAgICAgICBnbG9iYWwgJHRoaXNmaWxlOwoKICAgICAgICBh
c3NlcnRfZmlsZSgpOwoKICAgICAgICBleHRyYWN0KGxBdHRzKGFycmF5KAogICAgICAgICAg
ICAnZXNjYXBlJyA9PiAnaHRtbCcsCiAgICAgICAgKSwgJGF0dHMpKTsKCiAgICAgICAgcmV0
dXJuICgkZXNjYXBlID09ICdodG1sJykKICAgICAgICAgICAgPyB0eHBzcGVjaWFsY2hhcnMo
JHRoaXNmaWxlWydqY3JfZmlsZV9jdXN0b20nXSkKICAgICAgICAgICAgOiAkdGhpc2ZpbGVb
J2pjcl9maWxlX2N1c3RvbSddOwogICAgfSI7czozOiJtZDUiO3M6MzI6IjczNDgwNTdiMDJk
MjJmODJlM2U1NmIxMTA3NDA0YmEwIjt9
